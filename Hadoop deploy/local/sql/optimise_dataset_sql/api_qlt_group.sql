API_QLT_GROUP_QUERY=select v.SNAP_YEAR_MNTH_NBR,v.ST_CD,v.LOB_ID,v.PROD_ID,v.AGRGTN_ID,v.AGRGTN_TYPE_CD,v.SPCLTY_ID,v.SUBMRKT_CD,v.OE_QLTY_RT,v.LOWR_CNFDNC_LVL_NBR,v.UPR_CNFDNC_LVL_NBR from(SELECT a.SNAP_YEAR_MNTH_NBR as SNAP_YEAR_MNTH_NBR , ap.ST_CD as ST_CD , ap.LOB_ID as LOB_ID, ap.PROD_ID as PROD_ID , a.TAX_ID as AGRGTN_ID , 'TIN'  as AGRGTN_TYPE_CD , ap.SPCLTY_ID as SPCLTY_ID, ap. SUBMRKT_CD as SUBMRKT_CD , a.OE_QLTY_RT  as OE_QLTY_RT, a.CNFDNC_INTRVL_LOWR_NBR  as LOWR_CNFDNC_LVL_NBR, a.CNFDNC_INTRVL_UPR_NBR as UPR_CNFDNC_LVL_NBR FROM	QLTY_NRW_NTWK_TAX_SPCLTY a inner join (select b.BKBN_SNAP_YEAR_MNTH_NBR, b.ST_CD  , b.LOB_ID , b.PROD_ID , b.PROV_TAX_ID , b.SPCLTY_ID , b.AGRGTN_TYPE_CD, b. SUBMRKT_CD , b. PEER_MRKT_CD from API_PROV_WRK  b group by b.BKBN_SNAP_YEAR_MNTH_NBR, b.ST_CD  , b.LOB_ID , b.PROD_ID , b.PROV_TAX_ID , b.SPCLTY_ID , b.AGRGTN_TYPE_CD, b. SUBMRKT_CD , b. PEER_MRKT_CD ) as AP on a.TAX_ID = ap.PROV_TAX_ID and ap. AGRGTN_TYPE_CD = 'TIN' and  ap.BKBN_SNAP_YEAR_MNTH_NBR = a.SNAP_YEAR_MNTH_NBR   join (select max( a.BKBN_SNAP_YEAR_MNTH_NBR) as BKBN_SNAP_YEAR_MNTH_NBR from PCR_ELGBL_PROV a inner join(select  b.BKBN_SNAP_YEAR_MNTH_NBR as BKBN_SNAP_YEAR_MNTH_NBR from PCR_GRP_EFCNCY_RATIO_MULTI_SPLT b  group by BKBN_SNAP_YEAR_MNTH_NBR  ) as BB on BB.BKBN_SNAP_YEAR_MNTH_NBR = a.BKBN_SNAP_YEAR_MNTH_NBR inner join (select  c.BKBN_SNAP_YEAR_MNTH_NBR as BKBN_SNAP_YEAR_MNTH_NBR from PCR_GRP_EFCNCY_RATIO c  group by BKBN_SNAP_YEAR_MNTH_NBR  ) as cc on cc.BKBN_SNAP_YEAR_MNTH_NBR = a.BKBN_SNAP_YEAR_MNTH_NBR inner join (select  d.SNAP_YEAR_MNTH_NBR as SNAP_YEAR_MNTH_NBR from QLTY_NRW_NTWK_TAX_SPCLTY  d group by SNAP_YEAR_MNTH_NBR ) as dd on dd.SNAP_YEAR_MNTH_NBR = a.BKBN_SNAP_YEAR_MNTH_NBR)demo  where a.SNAP_YEAR_MNTH_NBR=demo.BKBN_SNAP_YEAR_MNTH_NBR   and a.SCRBL_IND_CD = 'Y' group by a.SNAP_YEAR_MNTH_NBR,ap.ST_CD,ap.LOB_ID,ap.PROD_ID,a.TAX_ID,'TIN',ap.SPCLTY_ID,ap. SUBMRKT_CD,a.OE_QLTY_RT,a.CNFDNC_INTRVL_LOWR_NBR,a.CNFDNC_INTRVL_UPR_NBR   union all    SELECT a.SNAP_YEAR_MNTH_NBR as SNAP_YEAR_MNTH_NBR , ap.ST_CD as ST_CD , ap.LOB_ID as LOB_ID, ap.PROD_ID as PROD_ID , a.NPI as AGRGTN_ID , 'NPI'  as AGRGTN_TYPE_CD , ap.SPCLTY_ID as SPCLTY_ID, ap. SUBMRKT_CD as SUBMRKT_CD , a.OE_QLTY_RT  as OE_QLTY_RT, a.CNFDNC_INTRVL_LOWR_NBR  as LOWR_CNFDNC_LVL_NBR, a.CNFDNC_INTRVL_UPR_NBR as UPR_CNFDNC_LVL_NBR FROM	QLTY_NRW_NTWK_NPI a inner join (select b.BKBN_SNAP_YEAR_MNTH_NBR, b.ST_CD  , b.LOB_ID , b.PROD_ID , b.NPI , b.SPCLTY_ID , b.AGRGTN_TYPE_CD, b. SUBMRKT_CD , b. PEER_MRKT_CD from API_PROV_WRK  b group by b.BKBN_SNAP_YEAR_MNTH_NBR, b.ST_CD  , b.LOB_ID , b.PROD_ID , b.NPI , b.SPCLTY_ID , b.AGRGTN_TYPE_CD, b. SUBMRKT_CD , b. PEER_MRKT_CD ) as AP on a.NPI = ap. NPI and ap. AGRGTN_TYPE_CD = 'NPI' and  ap.BKBN_SNAP_YEAR_MNTH_NBR = a.SNAP_YEAR_MNTH_NBR    join (select max( a.BKBN_SNAP_YEAR_MNTH_NBR) as BKBN_SNAP_YEAR_MNTH_NBR from PCR_ELGBL_PROV a inner join(select  b.BKBN_SNAP_YEAR_MNTH_NBR as BKBN_SNAP_YEAR_MNTH_NBR from PCR_GRP_EFCNCY_RATIO_MULTI_SPLT b  group by BKBN_SNAP_YEAR_MNTH_NBR  ) as BB on BB.BKBN_SNAP_YEAR_MNTH_NBR = a.BKBN_SNAP_YEAR_MNTH_NBR inner join (select  c.BKBN_SNAP_YEAR_MNTH_NBR as BKBN_SNAP_YEAR_MNTH_NBR from PCR_GRP_EFCNCY_RATIO c  group by BKBN_SNAP_YEAR_MNTH_NBR  ) as cc on cc.BKBN_SNAP_YEAR_MNTH_NBR = a.BKBN_SNAP_YEAR_MNTH_NBR inner join (select  d.SNAP_YEAR_MNTH_NBR as SNAP_YEAR_MNTH_NBR from QLTY_NRW_NTWK_TAX_SPCLTY  d group by SNAP_YEAR_MNTH_NBR ) as dd on dd.SNAP_YEAR_MNTH_NBR = a.BKBN_SNAP_YEAR_MNTH_NBR)demo  where a.SNAP_YEAR_MNTH_NBR=demo.BKBN_SNAP_YEAR_MNTH_NBR  and a.SCRBL_IND_CD = 'Y' group by a.SNAP_YEAR_MNTH_NBR,ap.ST_CD,ap.LOB_ID,ap.PROD_ID,a.NPI,'NPI',ap.SPCLTY_ID,ap. SUBMRKT_CD,a.OE_QLTY_RT, a.CNFDNC_INTRVL_LOWR_NBR  , a.CNFDNC_INTRVL_UPR_NBR )v  group by v.SNAP_YEAR_MNTH_NBR,v.ST_CD,v.LOB_ID,v.PROD_ID,v.AGRGTN_ID,v.AGRGTN_TYPE_CD,v.SPCLTY_ID,v.SUBMRKT_CD,v.OE_QLTY_RT,v.LOWR_CNFDNC_LVL_NBR,v.UPR_CNFDNC_LVL_NBR
API_QLT_GROUP_INSERTQUERY=select snap_year_mnth_nbr,st_cd,lob_id,prod_id,agrgtn_id,agrgtn_type_cd,spclty_id,submrkt_cd,oe_qlty_rt,lowr_cnfdnc_lvl_nbr,upr_cnfdnc_lvl_nbr,run_id from API_QLT_GROUP